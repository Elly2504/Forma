---
/**
 * CheckpointGrid Component
 * 
 * Visual 11-checkpoint grid with Manchester United example.
 * Shows pass/fail/warning states for each validation signal.
 */

interface Checkpoint {
  id: string;
  icon: string;
  label: string;
  weight: string;
  status: 'pass' | 'fail' | 'warning' | 'na';
  evidence: string;
}

const checkpoints: Checkpoint[] = [
  { id: 'database', icon: 'ðŸ”', label: 'Database Match', weight: '25%', status: 'pass', evidence: 'Code 237867-648 found: Nike Man Utd 2007/08 Home' },
  { id: 'blacklist', icon: 'â›”', label: 'Blacklist Check', weight: '20%', status: 'pass', evidence: 'Not on known counterfeit codes list' },
  { id: 'format', icon: 'ðŸ“', label: 'Format Valid', weight: '15%', status: 'pass', evidence: 'Nike 6-3-digit format (NNNNNN-NNN) âœ“' },
  { id: 'sponsor', icon: 'ðŸ·ï¸', label: 'Sponsor Era', weight: '8%', status: 'pass', evidence: 'AIG sponsored 2006-2010, matches 2007 âœ“' },
  { id: 'brand', icon: 'ðŸ…', label: 'Brand Match', weight: '8%', status: 'pass', evidence: 'Nike filter = Nike result âœ“' },
  { id: 'technology', icon: 'âš™ï¸', label: 'Technology', weight: '7%', status: 'pass', evidence: 'Dri-FIT correct for Nike 2007 era' },
  { id: 'era', icon: 'ðŸ“…', label: 'Era Valid', weight: '5%', status: 'pass', evidence: 'Season 2007/08 in valid historical range' },
  { id: 'color', icon: 'ðŸŽ¨', label: 'Color Suffix', weight: '5%', status: 'pass', evidence: 'Suffix 648 â†’ 6 = Red (Home kit) âœ“' },
  { id: 'label', icon: 'ðŸ“', label: 'Label Position', weight: '4%', status: 'na', evidence: 'Adidas-only check (N/A for Nike)' },
  { id: 'origin', icon: 'ðŸŒ', label: 'Mfg. Origin', weight: '3%', status: 'pass', evidence: 'Thailand valid for Nike 2005-2015' },
  { id: 'manufacturer', icon: 'ðŸ­', label: 'Manufacturer Era', weight: 'Core', status: 'pass', evidence: 'Nike made Man Utd kits 2002-2015 âœ“' },
];

const passCount = checkpoints.filter(c => c.status === 'pass').length;
const totalChecks = checkpoints.filter(c => c.status !== 'na').length;
---

<div class="checkpoint-grid-container">
  <div class="checkpoint-header">
    <h3 class="checkpoint-title">11-Point Cross-Validation</h3>
    <p class="checkpoint-subtitle">Each signal contributes to the final confidence score</p>
  </div>

  <div class="checkpoint-grid">
    {checkpoints.map((cp, index) => (
      <div 
        class={`checkpoint-item checkpoint-${cp.status}`} 
        data-tooltip={cp.evidence}
        style={`animation-delay: ${index * 0.05}s`}
      >
        <div class="checkpoint-icon">{cp.icon}</div>
        <div class="checkpoint-info">
          <span class="checkpoint-label">{cp.label}</span>
          <span class="checkpoint-weight">{cp.weight}</span>
        </div>
        <div class="checkpoint-status">
          {cp.status === 'pass' && <span class="status-icon status-pass">âœ“</span>}
          {cp.status === 'fail' && <span class="status-icon status-fail">âœ—</span>}
          {cp.status === 'warning' && <span class="status-icon status-warning">âš </span>}
          {cp.status === 'na' && <span class="status-icon status-na">â€”</span>}
        </div>
        
        <!-- Tooltip -->
        <div class="checkpoint-tooltip">
          <p>{cp.evidence}</p>
        </div>
      </div>
    ))}
  </div>

  <!-- Summary -->
  <div class="checkpoint-summary">
    <div class="summary-score">
      <div class="score-circle">
        <span class="score-value">94%</span>
      </div>
      <div class="score-details">
        <span class="score-label">Confidence Score</span>
        <span class="score-checks">{passCount}/{totalChecks} checks passed</span>
      </div>
    </div>
    <div class="summary-verdict">
      <span class="verdict-badge verdict-authentic">Highly Likely Authentic</span>
      <p class="verdict-text">All critical signals verified successfully</p>
    </div>
  </div>
</div>

<style>
  .checkpoint-grid-container {
    max-width: 800px;
    margin: 0 auto;
  }

  .checkpoint-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .checkpoint-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
    margin-bottom: 0.5rem;
  }

  .checkpoint-subtitle {
    font-size: 0.9rem;
    color: var(--text-muted);
  }

  .checkpoint-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 0.75rem;
    margin-bottom: 2rem;
  }

  .checkpoint-item {
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.875rem 1rem;
    background: rgba(24, 24, 27, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    animation: checkpointReveal 0.4s ease-out forwards;
    opacity: 0;
  }

  @keyframes checkpointReveal {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }

  .checkpoint-item:hover {
    transform: translateY(-2px);
  }

  .checkpoint-item:hover .checkpoint-tooltip {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  /* Status variants */
  .checkpoint-pass {
    border-color: rgba(16, 185, 129, 0.3);
    background: rgba(16, 185, 129, 0.05);
  }

  .checkpoint-fail {
    border-color: rgba(239, 68, 68, 0.3);
    background: rgba(239, 68, 68, 0.05);
  }

  .checkpoint-warning {
    border-color: rgba(234, 179, 8, 0.3);
    background: rgba(234, 179, 8, 0.05);
  }

  .checkpoint-na {
    border-color: rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.02);
    opacity: 0.6;
  }

  .checkpoint-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .checkpoint-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
  }

  .checkpoint-label {
    font-size: 0.8rem;
    font-weight: 600;
    color: white;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .checkpoint-weight {
    font-size: 0.65rem;
    color: var(--text-muted);
  }

  .checkpoint-status {
    flex-shrink: 0;
  }

  .status-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    font-size: 0.75rem;
    font-weight: 700;
  }

  .status-pass {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
  }

  .status-fail {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
  }

  .status-warning {
    background: rgba(234, 179, 8, 0.2);
    color: #eab308;
  }

  .status-na {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-muted);
  }

  /* Tooltip */
  .checkpoint-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(8px);
    width: max-content;
    max-width: 250px;
    padding: 0.75rem 1rem;
    background: #1f1f23;
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    font-size: 0.75rem;
    color: var(--text-secondary);
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    z-index: 10;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    margin-bottom: 8px;
  }

  .checkpoint-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: #1f1f23;
  }

  /* Summary */
  .checkpoint-summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
    border: 1px solid rgba(16, 185, 129, 0.3);
    border-radius: 16px;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .summary-score {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .score-circle {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #10b981, #059669);
    border-radius: 50%;
  }

  .score-value {
    font-size: 1.25rem;
    font-weight: 800;
    color: white;
  }

  .score-details {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .score-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: white;
  }

  .score-checks {
    font-size: 0.75rem;
    color: #10b981;
  }

  .summary-verdict {
    text-align: right;
  }

  .verdict-badge {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 100px;
    font-size: 0.8rem;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .verdict-authentic {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.4);
  }

  .verdict-text {
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  /* Responsive */
  @media (max-width: 640px) {
    .checkpoint-grid {
      grid-template-columns: 1fr;
    }

    .checkpoint-summary {
      flex-direction: column;
      text-align: center;
    }

    .summary-verdict {
      text-align: center;
    }
  }
</style>
