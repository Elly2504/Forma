# KitTicker Project Rules

## Core Philosophy
> "Do not be a black box; be a magnifying glass."

**API-First:** We build data infrastructure. Every feature is an API endpoint first, UI second.

## Current Focus
**Phase 3: B2B API Platform** — Infrastructure complete. Focus: data collection, customer acquisition.

### Target Segments (from 2026-01-18 research)
- Specialist Retailers (CFS) → Intake automation
- Circular Platforms (Birl, Trove) → White-label API
- Marketplaces (eBay, StockX) → Category trust
- Brand Protection (Nike, Adidas) → Fake code intel

---

## Tech Stack
| Layer | Technology |
|-------|------------|
| Marketing | **Astro 5** (static + SSR API) |
| API | **Vercel Edge** (Astro adapter) |
| Database | **Supabase (PostgreSQL)** |
| Language | **TypeScript** (strict) |
| Styling | **Tailwind CSS** |
| Theme | Dark mode, amber accents (`#F59E0B`) |

---

## Architecture: Hybrid SSR

```typescript
// astro.config.mjs
output: 'server'
adapter: vercel()

// All API files:
export const prerender = false;  // SSR at runtime
```

---

## API Design Rules

### Authentication
```
Authorization: Bearer kt_live_xxxxxxxxx
```

### Response Format
```typescript
// Success
{
  success: true,
  request_id: string,
  data: { ... }
}

// Error
{
  success: false,
  error: string,
  request_id: string
}
```

### Tier-Based Access
| Tier | Features |
|------|----------|
| Free | Lookup only |
| Starter | + Images, batch |
| Business | + Pricing, DPP |
| Enterprise | + SLA, custom |

---

## Naming Conventions
| Type | Convention | Example |
|------|------------|---------|
| API Routes | kebab-case | `codes/lookup.ts` |
| Lib files | kebab-case | `api-keys.ts` |
| Components | PascalCase | `ProductCodeChecker.astro` |
| Types | PascalCase | `ApiKey`, `ProductCode` |

---

## Key Files
| Path | Purpose |
|------|---------|
| `src/lib/api-keys.ts` | API key management |
| `src/lib/api-types.ts` | TypeScript interfaces |
| `src/lib/dpp.ts` | Digital Product Passport |
| `src/lib/verifier.ts` | Multi-signal auth |
| `src/pages/api/v1/*` | SSR API endpoints |

---

## Commands
| Command | Action |
|---------|--------|
| "update memory bank" | Update all memory-bank/*.md files |
| "what's next" | Check activeContext.md |
| "deploy" | `vercel --prod --yes` |

---

## Security Rules
1. **Never store raw API keys** — SHA-256 hash only
2. **Rate limit all endpoints** — Tier-based quotas
3. **Log all requests** — `api_usage_logs` table
4. **Validate all inputs** — Never trust user data
5. **Use RLS** — Row Level Security on all tables

---

## Development
```bash
# Local
cd landing && npm run dev    # http://localhost:4321

# Deploy
cd landing && vercel --prod --yes
```

---

## AI Assistant Instructions
1. Read `memory-bank/` at session start
2. Check `activeContext.md` for current state
3. Update `progress.md` after completing tasks
4. Log decisions in `activeContext.md`
5. Always use TypeScript, never `any`
6. Keep components under 150 lines
